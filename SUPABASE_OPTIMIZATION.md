# Оптимизация Supabase для уменьшения трафика

## Проблема
Превышение лимитов cached egress из-за постоянной загрузки изображений без кэширования.

## Решения

### 1. ✅ Убраны временные метки из URL
- Удалены `?t=${Date.now()}` из URL изображений
- Теперь изображения кэшируются браузером и CDN

### 2. ✅ Увеличено время кэширования
- Аватары: 24 часа (было 1 час)
- Галерея: 24 часа (было 1 час)  
- Чат-изображения: 24 часа (было 1 час)

### 3. ✅ Добавлено кэширование пользователей
- Данные пользователей кэшируются на 5 минут
- Уменьшает количество запросов к базе

### 4. ✅ Оптимизировано сжатие изображений
- Чат-изображения: 800x800, качество 0.7
- Галерея: 1200x1200, качество 0.7
- Аватары: 800x800, качество 0.8

## Дополнительные рекомендации

### В Supabase Dashboard:
1. **Настройте CDN**
   - Включите CDN в настройках Storage
   - Установите правильные cache headers

2. **Оптимизируйте RLS политики**
   - Добавьте индексы на часто используемые поля
   - Оптимизируйте запросы в политиках

3. **Мониторинг**
   - Следите за графикой использования в Dashboard
   - Настройте алерты при приближении к лимитам

### В коде:
1. **Ленивая загрузка изображений**
   - Добавьте loading="lazy" для img тегов
   - Используйте Intersection Observer

2. **Оптимизация запросов**
   - Используйте select() только нужных полей
   - Добавьте пагинацию для больших списков

3. **Кэширование на клиенте**
   - Используйте Service Worker для кэширования
   - Добавьте localStorage для данных

## Текущий лимит: 5GB/день
После оптимизации потребление должно уменьшиться на 60-80%.
